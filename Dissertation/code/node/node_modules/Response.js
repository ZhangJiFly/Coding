module.exports = function(query){
	var jade = require('jade');
	var jadeTemp = {
	'details':jade.compile("/Users/Crippled.Josh/Coding/Dissertation/code/Student/details.jade"),
	'courses':jade.compile("/Users/Crippled.Josh/Coding/Dissertation/code/Student/courses.jade"),
	'advisor':jade.compile("/Users/Crippled.Josh/Coding/Dissertation/code/Staff/advisor.jade"),
	'StaffHome':jade.compile("/Users/Crippled.Josh/Coding/Dissertation/code/Staff/home.jade"),
	'school':jade.compile("/Users/Crippled.Josh/Coding/Dissertation/code/Staff/school.jade"),
	'degree':jade.compile("/Users/Crippled.Josh/Coding/Dissertation/code/Staff/degree.jade"),
	'CCL':jade.compile("/Users/Crippled.Josh/Coding/Dissertation/code/Staff/CCL.jade"),
	'enrol':jade.compile("/Users/Crippled.Josh/Coding/Dissertation/code/Student/enrol.jade"),
	};
	var Staff = function(req, res){
		var file = req.params.file;
	    var StaffId = req.session.user.StaffId;
	    var school = req.session.user.School;
	    var degree = req.query.degree;
	    if (file == "home"){
	      var name = req.session.user.Forename + " " + req.session.user.Surname;
	      var email = req.session.user.Email;
	      var staffId = req.session.user.StaffId;
	      userX = {name: name, staffId: staffId, email: email}
	      var html = jadeTemp['StaffHome'](userX);
	      res.render(html);
	    }
	    else if (file == "advisor"){
	      query.advisees(StaffId, function(rows){
	        var Data = JSON.stringify(rows);
	        html = jadeTemp[file](aaData = JSON.stringify(rows));
	        res.render(html);
	      });
	    }
	    else if (file == "degree"){
	      query.degreeCourseLists(degree, function(dCourseLists){
	        query.courseLists(school, function(allCourseListNames){
	          query.singleDegree(degree, function(fullDegree){
	          	query.getCourseListsInfo(function(allCourseListInfo){
		            html = jadeTemp[file](Degree = degree, degreeDetails = JSON.stringify(fullDegree), School = school, dCourseLists = JSON.stringify(dCourseLists), AllCourseListNames = JSON.stringify(allCourseListNames), AllCourseListInfo = JSON.stringify(allCourseListInfo));
		            res.render(html);
		        });
	          });
	        });
	      });
	    }
	    else if (file == "school"){
	      query.degrees(school, function(degreeRows){
	        query.courseLists(school,function(courseRows){
	          html = jadeTemp[file](Degrees = JSON.stringify(degreeRows), CL = JSON.stringify(courseRows), School = school);
	          res.render(html);
	        });
	      });
	    }
	    else if (file == "CCL"){
			query.getSchoolCourses(school, function(courses){
				html = jadeTemp[file](data = JSON.stringify(courses));
				res.render(html);
			});
	    }
	    else{
	      res.sendfile("/Users/Crippled.Josh/Coding/Dissertation/code/Staff/" + file);   
	    }
  	}

  	var Student = function(req, res){
	    var file = req.params.file;
		var StaffId = req.session.user.Advisor;
		var degree = req.session.user.Degree;
		var matric = req.session.user.Matric
	    if (file == "details"){

	      var html
	      var name = req.session.user.Forename + " " + req.session.user.Surname;

	      var email = req.session.user.Email;
	      var advisorName = req.session.user.Advisor.Forename + " " + req.session.user.Advisor.Surname;
	      var advisorEmail = req.session.user.Advisor.Email
	      html = jadeTemp[file](user = {name: name, matric: matric, email: email, advisorName:advisorName, advisorEmail:advisorEmail});
	      res.render(html);
	    }
	    else if (file == "courses"){
	      	query.courses(matric, function(rows){
	        	html = jadeTemp[file](aaData = JSON.stringify(rows));
	        	res.render(html);
	      });
	    }
	    else if (file == "enrol"){
	    	query.degreeCourseListsTotal(degree, function(courseListData){
	    		query.getStudentCourses(matric , function(Courses){
	    			console.log(Courses);
					html = jadeTemp[file](CourseListData = JSON.stringify(courseListData), Degree = degree, courses = JSON.stringify({list:Courses}));
		        	res.render(html);
	    		})
			});
	    }
	    else{
	      res.sendfile("/Users/Crippled.Josh/Coding/Dissertation/code/Student/" + file);
	      
	    }

	  }

	var Post = function(req, res){
		request = req.route.path;
		console.log(request);
		var data = req.body;
		var school = req.session.user.School;
		if(request == "/CreateCourseList"){
			query.updateCourseList(data, school);
	    	query.updateGroup(data);
			res.redirect('/Staff/school');// doesnt work don't know why
		}
		else if(request == "/AssignCourseListNames"){
			var degree = data.degree;
			console.log(data);
			for (var i = 0; i<data.courseLists.length;i++){
				query.updateDegreeCourseLists(degree, school, i + 1, data.courseLists[i], function(){

				})
			}
			res.redirect('Staff/school');// doesnt work don't know why. 
		}
		else if(request == "/enrolInCourse"){
			var course = data.courseId;
			var matric = req.session.user.Matric;
			console.log(data);
			console.log(course);
			query.updateCoursesTaken(matric, course, function(response){
				res.send(response, "it worked!");
			});
		}
		else{
			res.status(404);
		}
	}
  	return {Post: Post, Staff: Staff, Student: Student};

}